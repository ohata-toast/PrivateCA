# コンソール利用ガイド
**Management > Private CA > コンソール利用ガイド**

Private CAコンソールは認証局(certificate authority, CA)を中心に構成されており、全てのリソース(証明書テンプレート、発行者、証明書、ACMEトークン)は特定のリポジトリに属します。コンソール画面は左側にリポジトリリスト、右側に選択したリポジトリの詳細情報を表示するタブ構造になっています。

## Private CA利用フロー

Private CAで証明書を発行するまでの過程は次のとおりです。

1. **リポジトリ作成**：証明書を管理するスペースを作成します。
2. **発行者作成**：証明書に署名する認証局(CA)を作成します。
    - Root CA:最上位認証局
    - Intermediate CA:Root CAの下位の中間認証局
3. **証明書テンプレート作成**：同じ設定で複数の証明書を発行する際に使用します。
4. **証明書発行**：証明書テンプレートを通じて実際に使用する証明書を発行します。

!!! tip 「ポイント」
    - **CA(certificate authority, 認証局)**：証明書を発行し署名する主体です。
    - **Root CA**：自己署名した最上位証明書です。全ての信頼の起点です。
    - **Intermediate CA**：Root CAによって署名された中間証明書です。実際のサーバー証明書発行に使用されます。

## リポジトリ

リポジトリはPrivate CAを管理する基本単位です。リポジトリを作成すると、発行者、証明書テンプレート、証明書などを管理できます。

### リポジトリ追加

1. コンソール左上の**+ 追加**をクリックしてリポジトリを追加します。
  ![ca_empty_list](https://static.toastoven.net/prod_privateca/2025-12-23_ko/ca_init.png)

2. リポジトリ追加モーダルウィンドウで次の情報を入力します。
  ![ca_create](https://static.toastoven.net/prod_privateca/2025-12-23_ko/ca_create.png)
    - **リポジトリ名**(必須)：リポジトリを識別する名前を入力します。
    - **リポジトリ説明**(選択)：リポジトリに関する説明を入力します。
    - **CRL有効化**
        - CRL(certificate revocation list、証明書失効リスト)を有効にするかどうかを選択します。
        - 失効した証明書リストを定期的に提供し、クライアントが証明書の有効性を確認できるようにします。
        - CRLを有効化すると、更新サイクルを日単位で設定できます。
    - **OCSP有効化**
        - OCSP(online certificate status protocol)を有効にするかどうかを選択します。
        - 個別の証明書の失効状態をリクエスト時点の状態で素早く確認できるプロトコルです。
        - OCSPを有効化すると、更新サイクルを時間単位で設定できます。

3. **作成**をクリックしてリポジトリを作成します。

### リポジトリ修正、削除

リポジトリリストで各リポジトリ項目の右側にあるメニューボタン(⋮)をクリックすると、次の作業を実行できます。
![overview_3dot](https://static.toastoven.net/prod_privateca/2025-12-23_ko/overview_3dot.png)

- **修正**：リポジトリの名前、説明、CRL/OCSP設定を変更できます。
- **削除**：リポジトリを削除します。
    - リポジトリを削除すると、該当リポジトリに属する全てのリソース(発行者、証明書テンプレート、証明書、ACMEトークン)が一緒に削除されます。

!!! danger "注意"
    削除作業は元に戻せないため注意が必要です。

### リポジトリ詳細情報

左側のリポジトリリストで希望するリポジトリをクリックすると、右側の画面にリポジトリの詳細情報が表示されます。リポジトリ詳細情報画面はリポジトリ名、説明とタブリスト、そして複数の詳細情報で構成されています。

#### タブリスト

リポジトリを選択すると、右側の画面上部には次のようなタブがあり、各タブをクリックして該当機能に移動できます。
![overview_tabs](https://static.toastoven.net/prod_privateca/2025-12-23_ko/overview_tabs.png)

- **概要**：リポジトリの統計情報と設定情報
- **証明書テンプレート**：証明書テンプレートリスト及び管理
- **発行者**：証明書発行者リスト及び管理
- **証明書**：発行された証明書リスト及び管理
- **ACME管理**：ACMEトークンリスト及び管理
- **証明書履歴**：リポジトリの証明書履歴確認

#### リソース統計カード

画面上部にはリポジトリの主要リソース数を表示するカードが3つ表示されます。
![overview_resource_card](https://static.toastoven.net/prod_privateca/2025-12-23_ko/overview_resource_card.png)

- **証明書テンプレート**：作成された証明書テンプレート総数
- **発行者**：作成された発行者(Root CA、Intermediate CA)総数
- **証明書**：発行された証明書総数

各カードの**{カード名}表示 >**をクリックすると、該当リソースの管理タブにすぐに移動できます。

#### ACME情報

リソースカード下部にはACME情報が表示されます。
![overview_acme_info](https://static.toastoven.net/prod_privateca/2025-12-23_ko/overview_acme_info.png)

- **全トークン**：作成されたACMEトークン総数
- **アクティブトークン**：アクティブ状態のACMEトークン数
- **削除されたトークン**：削除されたACMEトークン数

#### リポジトリ詳細情報

ACME情報下部にはリポジトリ詳細情報が表示されます。
![overview_detail](https://static.toastoven.net/prod_privateca/2025-12-23_ko/overview_detail.png)

- **リポジトリID**：リポジトリのID
- **CRL URL**：証明書失効リスト(certificate revocation list)を確認できるURL
- **CRL更新サイクル**：CRLが更新される周期(日単位)
- **OCSP URL**：OCSP(online certificate status protocol)レスポンダURL
- **OCSP更新サイクル**：OCSP情報が更新される周期(時間単位)

!!! tip 「ポイント」
    CRLとOCSPは証明書の失効状態を確認する方法です。CRLは失効した証明書リストを提供し、OCSPは個別証明書の状態をリクエスト時点の状態で素早く照会できます。

## 発行者

発行者は証明書に署名し発行する認証局です。Private CAではRoot CAとIntermediate CAの2種類のタイプの発行者を作成できます。

### 発行者タイプ選択ガイド

- **Root CAのみ使用する場合**：小規模組織内部用証明書発行
- **Root CA + Intermediate CA使用する場合**
    - Root CAの秘密鍵を安全に保管したい場合
    - 複数の部署/プロジェクト別に別途CAを運営したい場合
    - セキュリティベストプラクティスに従いたい場合(推奨)

### 発行者リスト

発行者タブでは作成された全ての発行者をテーブル形式で確認できます。テーブルには次の情報が表示されます。
![issuer_list_after](https://static.toastoven.net/prod_privateca/2025-12-23_ko/issuer_list_after.png)

- **名前**：発行者の名前
- **状態**：発行者の現在の状態
    - **active**：正常に使用可能な状態(青色)
    - **revoked**：失効した状態(赤色)
- **タイプ**：RootまたはIntermediate
- **シリアル番号**：証明書の固有シリアル番号
- **一般名**：証明書の一般名

各発行者項目には**失効**ボタンがあり、必要に応じて発行者を**失効させる**ことができます。

### 発行者追加

1. 発行者タブで**+ 追加**をクリックします。
  ![issuer_list](https://static.toastoven.net/prod_privateca/2025-12-23_ko/issuer_list.png)


2. 発行者作成ページで次の情報を入力します。
  ![issuer_create](https://static.toastoven.net/prod_privateca/2025-12-23_ko/issuer_create.png)
    - 基本情報
        - **発行者タイプ**：発行者のタイプとしてRootまたはIntermediateを選択
            - **Root**：最上位認証局で、自己署名された証明書です。
            - **Intermediate**：中間認証局で、Root CAによって署名されます。
                - **上位証明書ID**：Intermediateタイプを選択した場合、上位発行者を選択します。
                  ![issuer_create_intermediate](https://static.toastoven.net/prod_privateca/2025-12-23_ko/issuer_create_intermediate.png)
        - **発行者名**(必須)：発行者を識別する名前
        - **発行者説明**(選択)：発行者に関する説明
        - **一般名**(必須)：証明書一般名
        - **有効期限設定**(必須)：有効期間を入力し、TTLまたは特定の日付のいずれかを選択
            - **TTL**：発行時点から指定した期間有効(例：365d、8760h、60m、30s)
            - **特定の日付**：特定の有効期限(有効終了時刻)を指定
        - **バックデート有効性**：証明書の有効開始時点を現在時刻より前に設定する期間です。時間同期の問題を防ぐために使用されます。(デフォルト値：30s / 例：1d、24h、60m、30s)
        - **最大パス長**：証明書チェーンでこの発行者の下に許可される中間CAの最大数を指定します。0はこれ以上下位CAを作成できないことを意味します。(例：0)

    - 鍵情報
        - **鍵アルゴリズム**：RSA、EC、ED25519の中から選択
        - **鍵ビット**：アルゴリズムによる鍵ビット選択

    - SAN(subject alternative name)設定
        - **SANから一般名除外**：SANリストから一般名(CN)を自動的に除外するかどうかを選択します。
        - **主体シリアル番号**：主体の固有シリアル番号を入力します。
        - **主体代替名(SANs)**：ドメイン形式の追加識別名(例：example.com、sub.example.com)
        - **IP主体代替名(IP SANs)**：IPアドレス形式の追加識別名(例：192.168.1.1、10.0.0.1)
        - **URI主体代替名(URI SANs)**：URI形式の追加識別名(例：https://example.com、spiffe://example.org)
        - **その他SANs**：その他形式のSAN(例：1.2.3.4;UTF8:test@example.com)

    - 主体情報(subject)
        - **国(C)**：国コード
        - **市/道(ST)**：州または道
        - **市/郡/区(L)**：都市名
        - **道路名住所**：道路名住所
        - **郵便番号**：郵便番号
        - **機関(組織)(O)**：組織名
        - **部署(組織単位)(OU)**：部署名

3. **追加**をクリックして発行者を追加します。

### 発行者詳細情報

発行者リストで発行者名をクリックすると詳細情報ページに移動します。詳細ページには次の情報が表示され、上部のダウンロードボタンを通じて証明書PEMファイルをダウンロードできます。
![issuer_detail](https://static.toastoven.net/prod_privateca/2025-12-23_ko/issuer_detail.png)

#### 証明書情報
- 状態、タイプ、シリアル番号
- 主体情報(subject DN)
- 発行者情報(Issuer DN)
- 鍵用途及び拡張鍵用途
- アルゴリズム及び鍵サイズ
- 有効期間(有効開始時刻、有効終了時刻)
- 証明書PEM内容

#### 発行者URL
- **発行証明書URL**：この発行者が発行した証明書リスト
- **CRL配布ポイント**：CRLを確認できるURL
- **OCSPサーバー**：OCSPレスポンダURL


### 発行者修正、失効

#### 発行者修正
発行者詳細ページで名前と説明を直接修正できます。修正後、**保存**をクリックして変更事項を保存します。

- 編集可能フィールド
    - **名前**：発行者名を修正できます。
    - **説明**：発行者説明を修正できます。

#### 発行者失効
1. 発行者リストで失効させる発行者の**失効**をクリックします。
2. 確認ダイアログで**失効**をクリックして失効を確定します。

!!! danger "注意"
    - 発行者を失効させると、該当発行者が発行した全ての証明書の信頼性に影響を及ぼします。失効した発行者はこれ以上証明書を発行できず、すでに発行された証明書はCRLまたはOCSPを通じて失効状態を確認できます。
    - ルート証明書は失効させることができません。

## 証明書テンプレート

証明書テンプレートは、証明書を迅速かつ一貫性を持って発行するための設定の集まりです。証明書テンプレートを使用すると、同じ設定で複数の証明書を簡単に発行できます。

### 証明書テンプレートリスト

証明書テンプレートタブでは、作成された全ての証明書テンプレートをテーブル形式で確認できます。テーブルには次の情報が表示されます。
![template_list_after](https://static.toastoven.net/prod_privateca/2025-12-23_ko/template_list_after.png)

- **名前**：証明書テンプレート名をクリックすると詳細情報に移動します。
- **説明**：証明書テンプレートに関する説明

各証明書テンプレート項目には**修正**及び**削除**ボタンがあり、証明書テンプレートを管理できます。

### 証明書テンプレート追加

1. 証明書テンプレートタブで**+ 追加**をクリックします。
  ![template_list](https://static.toastoven.net/prod_privateca/2025-12-23_ko/template_list.png)

2. 証明書テンプレート作成ページで次の情報を入力します。
  ![template_create](https://static.toastoven.net/prod_privateca/2025-12-23_ko/template_create.png)

    - 基本情報
        - **証明書テンプレート名**(必須)：証明書テンプレートを識別する名前
        - **説明**(任意)：証明書テンプレートに関する説明
        - **発行者選択**：この証明書テンプレートで作成された証明書に署名する発行者を選択します。

    - 制限設定
        - **有効期限設定**(必須)
            - **TTL**：最大有効期間設定(例：365d、8760h、60m、30s)
            - **特定の日付**：固定された有効期限(有効終了時刻)を指定
        - **バックデート有効性**：証明書の有効開始時点を現在時刻より前に設定する期間です。時間同期の問題を防ぐために使用されます。(デフォルト値：30s / 例：1d、24h、60m、30s)

    - SANオプション
        - **IP SANs許可**：IPアドレスをSANに含めることができるように許可します。
        - **URI主体代替名(URI SANs)**：URI形式のSANを入力します。(例：https://example.com、spiffe://example.org)
      - **その他SANs**：その他形式のSANを入力します。(例：1.2.3.4;UTF8:test@example.com)

    - 共通反映設定
        - 設定
            - **サーバー保存可否決定**：作成された証明書をサーバーに保存するかどうかを選択します。
            - **非CAに対する基本制約条件有効化**：CAではないことを証明書に明示するかどうかを選択します。

        - 鍵パラメータ
            - **鍵アルゴリズム**：RSA、EC、ED25519の中から選択
            - **鍵ビット**：アルゴリズムによる鍵ビット選択
            - **署名ビット**：証明書署名に使用するハッシュアルゴリズムのビット数選択

            !!! danger "注意"
                署名ビットはRSAアルゴリズムの場合のみ設定可能です。その他のアルゴリズムでは無視されます。

        - 鍵用途(Key Usage)
            - `digitalSignature`(デジタル署名)、`keyEncipherment`(鍵暗号化)、`keyCertSign`(証明書署名)など、証明書の用途を選択します。

        - 拡張鍵用途(Extended Key Usage)
            - `serverAuth`(TLSサーバー認証)、`clientAuth`(TLSクライアント認証)、`codeSigning`(コード署名)など、拡張鍵の使用用途を選択します。
            - **拡張鍵用途OIDs**：追加拡張鍵用途OIDを直接入力できます。(例：1.3.6.1.5.5.7.3.1、1.3.6.1.5.5.7.3.2)

        - ポリシー(Certificate Policies)
            - **ポリシーリスト**：証明書が遵守するポリシーを示すOIDを入力します。複数のOIDを入力できます。
                - 例：2.5.29.32.0(anyPolicy)、1.2.3.4.5(組織固有ポリシー)
            - 証明書ポリシーフィールドは、証明書がどのポリシーの下で発行されたかを明示し、証明書検証時にポリシー遵守可否を確認するために使用されます。

    - 追加主体フィールド
        - **CSR一般名使用**：CSRのCNを証明書にそのまま使用するかどうかを選択します。
        - **CSR SANs使用**：CSRのSANを証明書に含めるかどうかを選択します。
        - **国(C)**：国コード
        - **市/道(ST)**：州または道
        - **市/郡/区(L)**：都市名
        - **道路名住所**：道路名住所
        - **郵便番号**：郵便番号
        - **機関(組織)(O)**：組織名
        - **部署(組織単位)(OU)**：部署名

        !!! danger "注意"
            CSRのSubject DNに対する値を設定しても、証明書テンプレートで設定した値で上書きされます。

3. **追加**をクリックして証明書テンプレートを追加します。

### 証明書テンプレート詳細情報

証明書テンプレートリストで証明書テンプレート名をクリックすると詳細情報ページに移動します。詳細ページは折りたたみ可能なセクションで構成されており、ユーザーが入力した情報を確認できます。
![template_detail](https://static.toastoven.net/prod_privateca/2025-12-23_ko/template_detail.png)

詳細ページ上部には**+ 証明書新規作成**及び**修正**、**削除**ボタンがあります。

### 証明書テンプレート修正、削除

#### 証明書テンプレート修正
1. 証明書テンプレートリストで**修正**をクリックするか、詳細ページで**修正**をクリックします。
2. 証明書テンプレート修正ページで必要な内容を変更します。
3. **修正**をクリックして変更事項を保存します。

#### 証明書テンプレート削除
1. 証明書テンプレートリストで削除する証明書テンプレートの**削除**をクリックするか、詳細ページで**削除**をクリックします。
2. 確認ダイアログで**削除**をクリックして削除を確定します。

!!! tip 「ポイント」
    証明書テンプレートを削除しても、該当証明書テンプレートですでに作成された証明書には影響しません。

### 証明書テンプレートを使用した証明書作成

証明書テンプレートを使用して証明書を作成する方法は次のとおりです。

1. 証明書テンプレート詳細ページ上部の**+ 証明書新規作成**をクリックします。
  ![template_detail_generate](https://static.toastoven.net/prod_privateca/2025-12-23_ko/template_detail_generate.png)

2. 証明書作成形式を選択します。
  ![template_generate](https://static.toastoven.net/prod_privateca/2025-12-23_ko/template_generate.png)
    - **証明書CSR署名**を選択した場合、次のように異なる形式の入力フォームが表示されます。
  ![template_generate_csr](https://static.toastoven.net/prod_privateca/2025-12-23_ko/template_generate_csr.png)

3. 証明書作成ページで次の情報を入力します。
    - **一般名**(必須)：証明書の主体名
    - **有効期限設定**(必須)：証明書テンプレートの最大設定範囲内で設定
    - **SAN情報**：追加SAN情報

4. **確認**をクリックして証明書を作成します。

作成された証明書はユーザーの選択に応じてPrivate CAに保存でき、保存した場合は証明書タブで確認できます。

## 証明書

証明書タブではリポジトリから発行された全ての証明書を照会及び管理できます。

### 証明書リスト

証明書タブでは発行された全ての証明書をテーブル形式で確認できます。テーブルには次の情報が表示されます。
![certificate_list](https://static.toastoven.net/prod_privateca/2025-12-23_ko/certificate_list.png)

- **一般名**：証明書の一般名をクリックすると詳細情報に移動します。
- **状態**：証明書の現在の状態
    - **active**：正常に使用可能な状態(青色)
    - **revoked**：失効した状態(赤色)
- **シリアル番号**：証明書の固有シリアル番号
- **有効開始時刻**：証明書が有効になった時点

各証明書項目には**ダウンロード**及び**失効**ボタンがあり、証明書を管理できます。

### 証明書詳細情報

証明書リストで一般名をクリックすると詳細情報ページに移動します。詳細ページには次の情報が表示され、上部のダウンロードボタンを通じて証明書PEMファイルをダウンロードできます。
![certificate_detail](https://static.toastoven.net/prod_privateca/2025-12-23_ko/certificate_detail.png)

#### 証明書情報
- **一般名**：証明書の一般名
- **シリアル番号**：固有シリアル番号
- **証明書**：証明書PEM情報
- **CAチェーン**：チェーン証明書PEM情報
- **有効期間**
    - **有効開始時刻**：証明書が有効になる開始時点
    - **有効終了時刻**：証明書が失効する時点
- **アルゴリズム及び鍵サイズ**：署名アルゴリズムと鍵長
- **鍵用途**：digitalSignature、keyEnciphermentなど
- **拡張鍵用途**：serverAuth、clientAuthなど

### 証明書失効

証明書を失効させるには次のように進めます。

1. 証明書リストで失効させる証明書テンプレートの**失効**をクリックするか、詳細ページで**失効**をクリックします。
2. 確認ダイアログで**失効**をクリックして失効を確定します。

失効した証明書はもはや信頼できないと見なされ、次のような方法で失効状態を確認できます。

- **CRL(certificate revocation list)**：リポジトリのCRL URLを通じて失効した証明書リストを確認できます。
- **OCSP(online certificate status protocol)**：リポジトリのOCSP URLを通じて個別証明書の状態を照会できます。

!!! danger "注意"
    証明書の失効は元に戻せない作業です。失効した証明書は再度有効化できないため、新しい証明書を発行する必要があります。

## ACME管理

ACME(automated certificate management environment)は証明書の発行及び更新を自動化するプロトコルです。Private CAのACME管理機能を使用すると、Let's Encryptクライアント(例：certbot)のようなACMEクライアントを通じて自動的に証明書を発行できます。

### ACMEトークンリスト

ACME管理タブでは作成された全てのACMEトークンをテーブル形式で確認できます。テーブルには次の情報が表示されます。
![acme_list_after](https://static.toastoven.net/prod_privateca/2025-12-23_ko/acme_list_after.png)

- **名前**：ACMEトークンの名前をクリックすると詳細情報に移動します。
- **ID**：ACMEトークンID
- **説明**：ACMEトークンに関する説明

各トークン項目には**削除**ボタンがあり、使用しなくなったトークンを削除できます。

### ACMEトークン追加

1. ACME管理タブで**+ ACMEトークン追加**をクリックします。
  ![acme_list](https://static.toastoven.net/prod_privateca/2025-12-23_ko/acme_list.png)

2. ACMEトークン作成モーダルウィンドウで次の情報を入力します。
  ![acme_create](https://static.toastoven.net/prod_privateca/2025-12-23_ko/acme_create.png)
    - **名前**(必須)：ACMEトークンを識別する名前
    - **説明**(任意)：ACMEトークンに関する説明

3. **作成**をクリックしてトークンを作成します。

#### ACMEトークン作成完了後の情報確認
![acme_once](https://static.toastoven.net/prod_privateca/2025-12-23_ko/acme_once.png)
トークンが作成されると、次の情報が表示されます。

- **トークンID**：ACMEクライアント設定に使用される識別子
- **HMACキー**：ACMEクライアント認証に使用される秘密鍵

!!! danger "注意"
    HMACキーはトークン作成時に一度だけ表示されます。必ず安全な場所にコピーして保管する必要があり、その後は再確認できません。HMACキーを紛失した場合は新しいトークンを作成する必要があります。

### ACMEトークン詳細情報

![acme_detail](https://static.toastoven.net/prod_privateca/2025-12-23_ko/acme_detail.png)
トークンリストでトークン名をクリックすると詳細情報ページに移動します。詳細ページには次の情報が表示されます。

#### 発行された証明書
トークンを使用して発行された証明書リストが表示されます。各証明書は次の情報を含みます。

- **一般名**：証明書一般名
- **状態**：証明書状態
- **シリアル番号**：証明書シリアル番号
- **有効開始日**：証明書有効開始日

### ACMEクライアント設定例

[ACMEを利用した証明書更新](./acme-guide.md)ページを参考にして作成します。

### ACMEトークン削除

1. ACME管理タブで削除するトークンの**削除**をクリックします。
  ![acme_detail_delete](https://static.toastoven.net/prod_privateca/2025-12-23_ko/acme_detail_delete.png)

2. 確認ダイアログで**削除**をクリックして削除を確定します。

!!! tip 「ポイント」
    ACMEトークンを削除しても、該当トークンですでに発行された証明書には影響しません。ただし、該当トークンを使用した自動更新は動作しなくなるため、新しいトークンを作成してACMEクライアント設定を更新する必要があります。

## 証明書履歴

![history](https://static.toastoven.net/prod_privateca/2025-12-23_ko/history.png)
証明書履歴タブではリポジトリで発生した証明書関連の活動を時系列で確認できます。履歴には次のような情報が含まれます。

- 発行者、証明書作成履歴
- 証明書失効履歴

履歴情報を通じてリポジトリの証明書管理活動を追跡し、監査できます。
